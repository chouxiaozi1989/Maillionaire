# 文件夹联动与账户管理优化 - 快速指南

## 🎯 三大功能改进

### 1️⃣ 文件夹列表账户联动

**功能**：切换账户时，文件夹列表自动更新

**使用方法**：
1. 在主界面顶部选择不同的账户
2. 文件夹列表自动刷新为该账户的文件夹
3. 邮件列表自动切换到收件箱

**技术实现**：
- 修改了 `src/views/Main.vue` 的 `handleAccountChange()` 方法
- 增加了文件夹和邮件的重新加载逻辑

---

### 2️⃣ 账户管理界面优化

**功能**：使用弹窗添加账户，无需页面跳转

**使用方法**：
1. 进入「设置」→「账户管理」
2. 点击「添加账户」按钮
3. 在弹窗中填写账户信息
4. 系统自动验证连接并添加账户

**新增组件**：
- `src/components/account/AccountFormModal.vue`（362行）
- 支持添加和编辑账户
- 支持 OAuth2 和 IMAP/SMTP 认证
- 包含详细的错误诊断

**优势**：
- ✅ 无页面跳转，体验流畅
- ✅ 统一的添加/编辑界面
- ✅ 详细的授权码获取指引（QQ/163/126）
- ✅ 连接失败时提供详细诊断信息
- ✅ 用户确认机制（失败时可选择继续）

---

### 3️⃣ 登录页代理设置入口

**功能**：在登录页即可配置网络代理

**使用方法**：
1. 在登录页点击「网络代理设置」按钮
2. 在弹窗中配置代理参数：
   - 启用/禁用代理
   - 选择协议（HTTP/HTTPS）
   - 输入服务器地址和端口
   - 可选：配置认证（用户名/密码）
3. 测试连接
4. 保存设置

**配置示例**：

```
启用代理：是
协议：HTTP
服务器地址：127.0.0.1
端口：7890
认证：否
```

**注意事项**：
- 💡 推荐使用 HTTP 协议（HTTPS 可能遇到 TLS 证书问题）
- 💡 修改代理设置后需要重启应用才能全面生效
- 💡 如果 HTTPS 测试失败，请使用 HTTP URL 测试（如 `http://www.baidu.com`）

---

## 📝 关键修改文件

### 新增文件
- `src/components/account/AccountFormModal.vue` - 账户表单弹窗组件

### 修改文件
- `src/views/Main.vue` - 账户切换时重新加载文件夹和邮件
- `src/views/Settings.vue` - 使用弹窗而非跳转添加账户
- `src/views/Login.vue` - 添加代理设置入口和弹窗

---

## 🧪 快速测试

### 测试1：文件夹联动
```
1. 添加两个不同的邮箱账户
2. 在主界面切换账户
3. 观察文件夹列表是否自动更新
4. 观察邮件列表是否切换到收件箱
```

### 测试2：弹窗添加账户
```
1. 进入「设置」→「账户管理」
2. 点击「添加账户」
3. 选择邮箱类型（如 QQ 邮箱）
4. 输入邮箱地址和授权码
5. 提交表单
6. 观察连接验证过程
7. 验证成功后，检查是否自动切换到新账户
```

### 测试3：代理设置
```
1. 在登录页点击「网络代理设置」
2. 启用代理
3. 配置代理参数（如 127.0.0.1:7890）
4. 点击「测试连接」
5. 点击「保存设置」
6. 观察代理配置信息提示
```

---

## ⚠️ 常见问题

### Q1: 切换账户时很慢怎么办？
**A**: 这是正常的，因为需要重新加载文件夹和邮件。如果长时间无响应，请检查网络连接。

### Q2: 添加账户时提示"IMAP连接失败"？
**A**: 请检查：
1. 是否在邮箱网页版开启了 IMAP 服务
2. 是否使用授权码而非登录密码
3. 授权码是否正确（QQ邮箱是16位字符）

### Q3: 代理测试连接失败？
**A**: 
1. 检查代理服务器是否正在运行
2. 检查地址和端口是否正确
3. 如果使用 HTTPS 协议，尝试改为 HTTP
4. 尝试使用 HTTP URL 测试（如 `http://www.baidu.com`）

### Q4: OAuth2 认证失败？
**A**: 
1. Gmail/Outlook 需要浏览器授权
2. 如果无法完成授权，系统会进入测试模式
3. 测试模式下功能受限，建议在正式环境中重新配置

---

## 🎨 用户体验提升

| 功能 | 改进前 | 改进后 |
|------|--------|--------|
| 文件夹列表 | 切换账户时不更新 | 自动联动更新 |
| 添加账户 | 跳转到登录页 | 弹窗添加，无跳转 |
| 代理设置 | 需登录后设置 | 登录页即可设置 |
| 错误提示 | 简单的错误信息 | 详细的诊断和解决方案 |
| 连接验证 | 验证失败即中止 | 用户可选择继续 |

---

## 📚 详细文档

查看完整的技术文档：[文件夹联动与账户管理优化.md](./文件夹联动与账户管理优化.md)

---

**创建时间**：2025-10-22  
**修改时间**：2025-10-22  
**文档版本**：1.0.0
