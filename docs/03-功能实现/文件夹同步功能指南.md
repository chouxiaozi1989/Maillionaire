# 文件夹同步功能使用指南

## 概述

Maillionaire 提供了强大的文件夹同步功能，支持与邮件服务器同步文件夹结构，以及创建、管理自定义文件夹。

---

## 功能特性

### 1. 系统文件夹

默认提供以下系统文件夹：

| 文件夹 | 说明 | 图标 |
|-------|------|------|
| 收件箱 | 接收的邮件 | 📥 |
| 已发送 | 已发送的邮件 | 📤 |
| 草稿箱 | 未完成的邮件草稿 | 📝 |
| 回收站 | 已删除的邮件 | 🗑️ |
| 星标邮件 | 标记为重要的邮件 | ⭐ |

**注意**：系统文件夹不能删除或重命名。

### 2. 自定义文件夹

支持创建自定义文件夹来组织邮件：

- ✅ 创建自定义文件夹
- ✅ 重命名文件夹
- ✅ 删除空文件夹
- ✅ 移动邮件到自定义文件夹

### 3. 服务器同步

与邮件服务器同步文件夹结构：

- ✅ 同步服务器文件夹到本地
- ✅ 创建文件夹自动同步到服务器
- ✅ 删除文件夹自动同步到服务器
- ✅ 显示最后同步时间

---

## 使用方法

### 创建自定义文件夹

1. 在主界面左侧边栏底部，点击 **新建文件夹** 按钮
2. 在弹出的对话框中输入文件夹名称
3. 点击 **确定** 创建
4. 新文件夹会自动同步到服务器（如果连接）

**命名规范**：
- 长度：1-50个字符
- 不能包含特殊字符：`/ \ : * ? " < > |`
- 不能与现有文件夹重名

### 同步服务器文件夹

1. 点击左侧边栏底部的 **同步** 按钮
2. 系统会从邮件服务器获取所有文件夹
3. 新文件夹会自动添加到本地列表
4. 同步完成后显示成功消息

**同步频率建议**：
- 手动同步：随时点击同步按钮
- 自动同步：可在设置中配置（开发中）

### 移动邮件到文件夹

#### 方法一：拖放操作（开发中）
1. 选中一封或多封邮件
2. 拖动到目标文件夹
3. 释放鼠标完成移动

#### 方法二：右键菜单（开发中）
1. 右键点击邮件
2. 选择"移动到"
3. 选择目标文件夹

#### 方法三：通过API
```javascript
// 使用 mailStore 移动邮件
await mailStore.moveMailToFolder(mailId, targetFolderId)
```

### 删除自定义文件夹

1. 右键点击自定义文件夹（开发中）
2. 选择"删除文件夹"
3. 确认删除操作
4. 文件夹内的邮件会移动到收件箱

**注意**：
- 只能删除空文件夹或将内容移至其他位置
- 系统文件夹不能删除

---

## 文件夹管理API

### 在代码中使用

```javascript
import { useMailStore } from '@/stores/mail'

const mailStore = useMailStore()

// 加载文件夹列表
await mailStore.loadFolders()

// 同步服务器文件夹
await mailStore.syncServerFolders()

// 创建文件夹
const newFolder = await mailStore.createFolder('工作邮件')

// 删除文件夹
await mailStore.deleteFolder(folderId)

// 移动邮件到文件夹
await mailStore.moveMailToFolder(mailId, targetFolderId)

// 获取文件夹列表
const folders = mailStore.folders

// 获取自定义文件夹
const customFolders = folders.filter(f => !f.system)
```

---

## IMAP 文件夹操作

### 服务层方法

```javascript
import { imapService } from '@/services/imap'

// 连接到服务器
await imapService.connect(accountConfig)

// 获取服务器文件夹列表
const folders = await imapService.getServerFolders()

// 创建文件夹
await imapService.createFolder('NewFolder')

// 删除文件夹
await imapService.deleteFolder('OldFolder')

// 重命名文件夹
await imapService.renameFolder('OldName', 'NewName')

// 移动邮件
await imapService.moveMail(uid, 'TargetFolder')

// 复制邮件
await imapService.copyMail(uid, 'TargetFolder')

// 断开连接
imapService.disconnect()
```

---

## 文件夹数据结构

### 文件夹对象

```javascript
{
  id: 'inbox',              // 唯一标识符
  name: '收件箱',           // 显示名称
  icon: 'InboxOutlined',    // 图标名称
  system: true,             // 是否为系统文件夹
  createdAt: '2025-10-19',  // 创建时间
  path: 'INBOX',            // 服务器路径
  delimiter: '/',           // 路径分隔符
  attributes: [],           // IMAP 属性
}
```

### 文件夹状态

```javascript
{
  folders: [],              // 文件夹列表
  isSyncing: false,         // 是否正在同步
  lastSyncTime: null,       // 最后同步时间
}
```

---

## 服务器文件夹映射

不同邮件提供商的文件夹名称可能不同：

| 功能 | Gmail | QQ邮箱 | 163邮箱 | Outlook |
|------|-------|--------|---------|---------|
| 收件箱 | INBOX | INBOX | INBOX | INBOX |
| 已发送 | [Gmail]/Sent Mail | Sent Messages | 已发送 | Sent Items |
| 草稿箱 | [Gmail]/Drafts | Drafts | 草稿箱 | Drafts |
| 回收站 | [Gmail]/Trash | Deleted Messages | 已删除 | Deleted Items |
| 垃圾邮件 | [Gmail]/Spam | Junk | 垃圾邮件 | Junk Email |

**系统会自动识别和映射这些文件夹。**

---

## 同步策略

### 初次同步

1. 连接到邮件服务器
2. 获取所有文件夹列表
3. 与本地文件夹对比
4. 添加新文件夹到本地
5. 标记已删除的文件夹

### 增量同步

1. 仅同步变更的文件夹
2. 保留本地自定义文件夹
3. 合并服务器和本地文件夹

### 冲突处理

- **服务器优先**：服务器文件夹覆盖本地
- **本地优先**：保留本地文件夹，手动解决冲突
- **合并模式**：同时保留服务器和本地文件夹

---

## 最佳实践

### 1. 文件夹组织建议

```
收件箱
├── 工作邮件
│   ├── 项目A
│   ├── 项目B
│   └── 会议通知
├── 个人邮件
│   ├── 家人
│   └── 朋友
└── 订阅邮件
    ├── 新闻
    └── 促销
```

### 2. 命名规范

- ✅ 使用清晰的中文名称
- ✅ 按类型或项目分组
- ✅ 使用数字前缀排序（如 `01-工作`, `02-个人`）
- ❌ 避免过深的层级（建议不超过3层）

### 3. 定期清理

- 定期清空回收站
- 归档旧邮件到存档文件夹
- 删除不再使用的自定义文件夹

### 4. 同步频率

- 工作时间：每小时同步一次
- 非工作时间：每4小时同步一次
- 紧急情况：手动立即同步

---

## 故障排除

### 同步失败

**问题**：点击同步按钮后提示失败

**解决方案**：
1. 检查网络连接
2. 确认账户登录状态
3. 检查IMAP服务器设置
4. 查看错误日志：`Console` → `Network`

### 文件夹不显示

**问题**：服务器文件夹在本地不显示

**解决方案**：
1. 手动点击同步按钮
2. 重启应用
3. 检查文件夹属性（某些文件夹可能被标记为 `\Noselect`）

### 创建文件夹失败

**问题**：创建文件夹时提示错误

**解决方案**：
1. 检查文件夹名称是否包含特殊字符
2. 确认是否与现有文件夹重名
3. 检查邮箱配额是否已满
4. 确认IMAP权限设置

### 移动邮件失败

**问题**：无法将邮件移动到文件夹

**解决方案**：
1. 确认目标文件夹存在
2. 检查邮件是否已被删除
3. 确认账户权限
4. 尝试手动同步

---

## 高级功能

### 文件夹规则（计划中）

自动将邮件移动到指定文件夹：

```javascript
// 示例：将来自特定发件人的邮件自动移至文件夹
{
  condition: {
    from: 'boss@company.com'
  },
  action: {
    moveToFolder: 'work'
  }
}
```

### 智能文件夹（计划中）

基于条件动态显示邮件：

- 今天的邮件
- 未读邮件
- 有附件的邮件
- VIP 发件人的邮件

### 文件夹权限（计划中）

共享文件夹权限管理：

- 只读
- 读写
- 管理员

---

## 数据存储

### 本地存储

文件夹配置存储在：
- **文件名**：`folders.json`
- **位置**：
  - Windows: `C:\Users\{用户名}\AppData\Roaming\Maillionaire\`
  - macOS: `~/Library/Application Support/Maillionaire/`
  - Linux: `~/.config/Maillionaire/`

### 数据格式

```json
{
  "folders": [
    {
      "id": "inbox",
      "name": "收件箱",
      "icon": "InboxOutlined",
      "system": true
    },
    {
      "id": "custom_123456",
      "name": "工作邮件",
      "icon": "FolderOutlined",
      "system": false,
      "createdAt": "2025-10-19T10:00:00.000Z"
    }
  ],
  "lastSyncTime": "2025-10-19T12:00:00.000Z"
}
```

---

## 相关文档

- [IMAP 服务使用指南](./IMAP服务使用指南.md)
- [邮件管理指南](./邮件管理指南.md)
- [二次开发文档](./二次开发文档.md)

---

**更新日期**：2025-10-19  
**版本**：v1.0.0
