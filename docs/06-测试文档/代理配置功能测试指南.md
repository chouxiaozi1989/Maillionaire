# 代理配置功能 - 快速测试指南

> 版本：v1.1.0  
> 测试日期：2025-10-19

---

## 🎯 测试目标

验证代理配置功能是否正常工作，包括：
1. ✅ 配置界面可以正常显示
2. ✅ 配置可以正常保存和读取
3. ✅ 代理连接测试功能正常
4. ✅ IMAP/SMTP 可以使用代理连接

---

## 🔧 准备工作

### 1. 启动代理软件

**使用 Clash：**
1. 启动 Clash
2. 确保端口为 7890（默认）
3. 开启系统代理或允许来自局域网的连接

**使用 V2Ray：**
1. 启动 V2Ray
2. 确保 SOCKS 端口为 1080
3. 记录端口号

### 2. 启动 Maillionaire

```bash
cd "c:\Users\Administrator\Documents\Maillionaire"
npm run dev
```

在另一个终端启动 Electron：

```bash
npm run electron:dev
```

---

## 📋 测试步骤

### 测试 1：配置界面显示

**步骤：**
1. 启动应用
2. 进入"设置"页面
3. 点击左侧菜单"代理设置"

**预期结果：**
- ✅ 显示代理设置面板
- ✅ 显示所有配置选项：
  - 启用代理（开关）
  - 代理协议（下拉框）
  - 服务器地址（输入框）
  - 端口（数字输入框）
  - 认证（开关）
  - 用户名/密码（认证启用时显示）
  - 保存、测试、重置按钮

**截图位置：**
`test-screenshots/proxy-settings-ui.png`

---

### 测试 2：默认配置检查

**步骤：**
1. 首次打开代理设置页面
2. 查看各配置项的默认值

**预期结果：**
- ✅ 启用代理：**关闭**
- ✅ 代理协议：**SOCKS5**
- ✅ 服务器地址：**127.0.0.1**
- ✅ 端口：**7890**
- ✅ 认证：**关闭**

---

### 测试 3：配置保存和读取

**步骤：**
1. 修改配置：
   - 启用代理：开启
   - 协议：SOCKS5
   - 地址：127.0.0.1
   - 端口：7890
2. 点击"保存设置"
3. 刷新页面或重启应用
4. 再次打开代理设置

**预期结果：**
- ✅ 显示成功消息："代理设置已保存"
- ✅ 配置被正确保存
- ✅ 重新打开后配置保持不变
- ✅ localStorage 中有 `proxy_config` 键

**验证 localStorage：**
打开浏览器控制台：
```javascript
localStorage.getItem('proxy_config')
// 应该输出：
// {"enabled":true,"protocol":"socks5","host":"127.0.0.1","port":7890,"auth":{"enabled":false,"username":"","password":""}}
```

---

### 测试 4：代理连接测试

**步骤：**
1. 确保 Clash 正在运行（端口 7890）
2. 配置代理为 SOCKS5://127.0.0.1:7890
3. 启用代理
4. 点击"测试连接"按钮

**预期结果：**
- ✅ 显示加载状态
- ✅ 几秒后显示"代理连接测试成功"消息
- ✅ 控制台输出：`[Proxy] Proxy enabled: socks5://127.0.0.1:7890`

**测试失败情况：**
1. 停止 Clash
2. 点击"测试连接"
3. 应显示："连接失败：XXX"

---

### 测试 5：认证功能

**步骤：**
1. 使用需要认证的代理服务器
2. 启用认证开关
3. 输入用户名和密码
4. 保存配置
5. 测试连接

**预期结果：**
- ✅ 认证字段显示
- ✅ 配置保存成功
- ✅ 代理 URL 包含认证信息（密码显示为 `***`）

---

### 测试 6：重置功能

**步骤：**
1. 修改所有配置项
2. 点击"重置为默认"按钮
3. 查看配置值

**预期结果：**
- ✅ 显示成功消息："已重置为默认设置"
- ✅ 所有配置恢复为默认值
- ✅ 启用代理被关闭

---

### 测试 7：协议切换

**步骤：**
1. 依次选择不同协议：
   - SOCKS5
   - SOCKS4
   - HTTP
   - HTTPS
2. 保存并测试每个协议

**预期结果（Clash 支持的情况）：**
- ✅ SOCKS5：测试成功
- ✅ HTTP：测试成功
- ⚠️ SOCKS4：可能成功（取决于 Clash 配置）
- ⚠️ HTTPS：可能成功

---

### 测试 8：Electron 主进程集成

**步骤：**
1. 启用代理配置
2. 保存设置
3. 查看 Electron 控制台输出

**预期结果：**
- ✅ 控制台输出：
  ```
  [Proxy] Proxy config updated: enabled
  [Proxy] Proxy enabled: socks5://127.0.0.1:7890
  [SMTP] Proxy config updated: enabled
  [IMAP] Proxy config updated: enabled
  ```

---

### 测试 9：IMAP/SMTP 代理连接（可选）

**步骤：**
1. 启用代理
2. 添加一个邮箱账户（如 Gmail）
3. 尝试连接 IMAP/SMTP

**预期结果：**
- ✅ 控制台输出：`[IMAP] Using proxy for connection`
- ✅ 控制台输出：`[SMTP] Using proxy for connection`
- ✅ 邮箱账户连接成功

**注意：**
- 这需要代理可以访问 Gmail 服务器
- 如果在中国大陆，需要确保代理可以翻墙

---

## 📊 测试结果记录表

| 测试项 | 状态 | 备注 |
|-------|------|------|
| 1. 配置界面显示 | ⬜ | |
| 2. 默认配置检查 | ⬜ | |
| 3. 配置保存和读取 | ⬜ | |
| 4. 代理连接测试 | ⬜ | |
| 5. 认证功能 | ⬜ | 可选 |
| 6. 重置功能 | ⬜ | |
| 7. 协议切换 | ⬜ | |
| 8. Electron 集成 | ⬜ | |
| 9. IMAP/SMTP 代理 | ⬜ | 可选 |

**状态说明：**
- ⬜ 未测试
- ✅ 通过
- ❌ 失败
- ⚠️ 部分通过

---

## 🐛 常见问题

### 问题 1：测试连接一直失败

**可能原因：**
1. Clash 未运行
2. 端口配置错误
3. 防火墙阻止

**解决方法：**
1. 检查 Clash 是否运行
2. 验证端口号（默认 7890）
3. 临时关闭防火墙测试

### 问题 2：配置保存后丢失

**可能原因：**
1. localStorage 被清除
2. 浏览器隐私模式

**解决方法：**
1. 检查浏览器设置
2. 使用正常模式（非隐私模式）

### 问题 3：Electron 主进程没有输出

**可能原因：**
1. Electron 未启动
2. IPC 通信失败

**解决方法：**
1. 确保使用 `npm run electron:dev`
2. 检查控制台错误信息

---

## 📝 测试报告模板

```
## 代理配置功能测试报告

**测试日期：** 2025-10-19  
**测试人员：** XXX  
**应用版本：** v1.1.0  

### 测试环境
- 操作系统：Windows 11 / macOS / Linux
- Node.js 版本：v16.x
- 代理软件：Clash / V2Ray / 其他
- 代理端口：7890

### 测试结果
- 配置界面：✅ 通过
- 配置保存：✅ 通过
- 连接测试：✅ 通过
- 重置功能：✅ 通过
- Electron 集成：✅ 通过

### 发现的问题
1. 无

### 建议
1. 考虑添加更多测试 URL 选项
2. 密码加密存储

### 总结
代理配置功能工作正常，满足设计要求。
```

---

## 🚀 自动化测试（未来计划）

### 单元测试

```javascript
// tests/unit/proxy-config.test.js
import { describe, it, expect } from 'vitest'
import { ProxyConfig, DEFAULT_PROXY_CONFIG } from '@/config/proxy'

describe('ProxyConfig', () => {
  it('should have correct default config', () => {
    const config = new ProxyConfig()
    expect(config.getConfig()).toEqual(DEFAULT_PROXY_CONFIG)
  })
  
  it('should save and load config', () => {
    const config = new ProxyConfig()
    const newConfig = {
      enabled: true,
      protocol: 'socks5',
      host: '192.168.1.1',
      port: 1080,
    }
    config.saveConfig(newConfig)
    expect(config.getConfig().host).toBe('192.168.1.1')
  })
})
```

### E2E 测试

使用 Playwright 或 Electron Spectron 进行端到端测试。

---

**测试完成后，请填写测试报告并提交！** ✅
