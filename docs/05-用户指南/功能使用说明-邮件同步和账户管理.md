# 功能使用说明：邮件同步和账户管理

> 快速上手指南  
> 版本：v1.1.0

---

## 📬 邮件同步功能

### 如何同步邮件？

1. **点击同步按钮**
   - 位置：主界面右上角的刷新图标 🔄
   - 快捷键：`Ctrl + R`（计划中）

2. **同步过程**
   ```
   第一步：验证账户连接
   ↓
   第二步：同步文件夹列表
   ↓
   第三步：拉取最新邮件（默认 50 封）
   ↓
   完成：显示新邮件数量
   ```

3. **同步结果**
   - ✅ 成功：显示"成功拉取 X 封新邮件"
   - ⚠️ 部分失败：显示具体错误信息
   - ❌ 失败：显示连接错误或认证失败

### 自动同步（计划中）

- 每 5 分钟自动同步一次
- 可在设置中调整同步间隔
- 可选择仅在 Wi-Fi 下自动同步

---

## 📂 文件夹管理

### 系统文件夹

邮件客户端自动识别以下文件夹：

| 服务器文件夹 | 显示名称 | 说明 |
|------------|---------|------|
| INBOX | 收件箱 | 接收的新邮件 |
| Sent / Sent Messages | 已发送 | 已发送的邮件 |
| Drafts | 草稿箱 | 未发送的草稿 |
| Trash / Deleted | 回收站 | 已删除的邮件 |
| Spam / Junk | 垃圾邮件 | 垃圾邮件 |

### 自定义文件夹

**创建文件夹**
1. 在文件夹列表底部点击"新建文件夹"
2. 输入文件夹名称
3. 点击确定

**同步服务器文件夹**
1. 点击文件夹列表底部的"同步"按钮
2. 系统自动获取服务器上的所有文件夹
3. 自定义文件夹会添加到列表中

**删除文件夹（计划中）**
- 只能删除自定义文件夹
- 系统文件夹无法删除

---

## 👤 账户管理

### 添加账户

**方式一：OAuth2 认证（Gmail、Outlook）**

1. 点击"添加邮箱账户"
2. 选择 Gmail 或 Outlook
3. 输入邮箱地址
4. 点击确定，跳转到授权页面
5. 授权后自动添加

**方式二：IMAP/SMTP 认证（QQ、163、126）**

1. 点击"添加邮箱账户"
2. 选择邮箱类型（QQ、163、126）
3. 输入邮箱地址
4. 输入授权码（非登录密码！）
5. 系统自动验证连接
6. 验证成功后添加

**获取授权码的方法**

- **QQ 邮箱**：设置 → 账户 → 开启 IMAP/SMTP 服务 → 生成授权码
- **163 邮箱**：设置 → POP3/SMTP/IMAP → 开启 IMAP 服务 → 生成授权码
- **126 邮箱**：设置 → POP3/SMTP/IMAP → 开启 IMAP 服务 → 生成授权码

### 编辑账户

1. **进入登录页面**
   - 点击主界面左上角的账户下拉框
   - 选择"切换账户"或直接退出登录

2. **编辑账户信息**
   - 悬停在账户列表项上
   - 点击"编辑"按钮（铅笔图标）✏️
   - 修改账户名称或密码
   - 点击确定保存

3. **可修改的信息**
   - ✅ 账户名称
   - ✅ 密码/授权码
   - ❌ 邮箱地址（不可修改）
   - ❌ 邮箱类型（不可修改）

### 删除账户

1. **进入登录页面**
   - 退出当前登录

2. **删除账户**
   - 悬停在账户列表项上
   - 点击"删除"按钮（垃圾桶图标）🗑️
   - 确认删除

3. **删除后的变化**
   - ❌ 账户从列表中移除
   - ❌ 该账户的所有本地邮件数据被删除
   - ✅ 如果删除的是当前账户，自动切换到第一个账户

**⚠️ 注意事项**

- 删除操作不可撤销
- 删除后邮件数据无法恢复（除非重新同步）
- 服务器上的邮件不会被删除

### 切换账户

**方式一：在主界面切换**
1. 点击左上角的账户下拉框
2. 选择要切换的账户
3. 系统自动加载该账户的邮件

**方式二：在登录页面切换**
1. 退出当前登录
2. 在账户列表中点击其他账户
3. 自动登录

---

## ⚙️ 同步设置

### 拉取邮件数量

当前默认拉取最新 50 封邮件，可通过以下方式调整：

```javascript
// 在代码中修改（开发者选项）
const newMails = await mailStore.fetchMailsFromServer('INBOX', {
  limit: 100,  // 修改为 100
  unreadOnly: false,
})
```

**未来计划：**
- 在设置页面提供数量选择器
- 支持拉取全部邮件
- 支持按日期范围拉取

### 只同步未读邮件

```javascript
// 仅拉取未读邮件
const newMails = await mailStore.fetchMailsFromServer('INBOX', {
  limit: 50,
  unreadOnly: true,  // 设置为 true
})
```

### 按日期范围拉取

```javascript
// 拉取最近 7 天的邮件
const since = new Date()
since.setDate(since.getDate() - 7)

const newMails = await mailStore.fetchMailsFromServer('INBOX', {
  limit: 200,
  since: since,
})
```

---

## 🔍 常见问题

### Q1: 为什么同步失败？

**可能原因：**

1. **网络问题**
   - 检查网络连接
   - 尝试切换网络

2. **认证失败**
   - 检查授权码是否正确
   - 检查授权码是否过期
   - 重新生成授权码

3. **IMAP 未开启**
   - 登录邮箱网页版
   - 检查 IMAP/SMTP 服务是否开启
   - 重新开启并生成授权码

4. **防火墙拦截**
   - 检查防火墙设置
   - 将应用添加到白名单

### Q2: 为什么拉取的邮件不完整？

**可能原因：**

1. **数量限制**
   - 默认只拉取最新 50 封
   - 可在设置中调整数量

2. **筛选条件**
   - 检查是否设置了"仅未读"
   - 检查日期范围筛选

3. **文件夹错误**
   - 确认当前选择的文件夹
   - 检查服务器文件夹映射

### Q3: 删除账户后还能恢复吗？

**答案：**

- ❌ 本地数据：无法恢复（已被删除）
- ✅ 服务器邮件：仍然存在
- 💡 解决方法：重新添加账户，重新同步

### Q4: 如何查看同步进度？

**当前版本：**
- 显示同步状态提示（"正在同步账户..."）
- 显示同步结果（"成功拉取 X 封邮件"）

**未来计划：**
- 实时进度条
- 邮件数量实时更新
- 网络速度显示

### Q5: 支持离线查看邮件吗？

**答案：**

- ✅ 已同步的邮件可离线查看
- ❌ 未同步的邮件需要联网拉取
- 💡 建议：定期同步邮件以便离线使用

---

## 💡 使用技巧

### 技巧 1：快速切换账户

在主界面使用快捷键（计划中）：
- `Ctrl + 1`：切换到第一个账户
- `Ctrl + 2`：切换到第二个账户
- `Ctrl + 3`：切换到第三个账户

### 技巧 2：批量操作邮件（计划中）

1. 按住 `Ctrl` 多选邮件
2. 点击批量操作按钮
3. 选择操作（标记已读、删除、移动等）

### 技巧 3：自定义文件夹组织邮件

1. 创建自定义文件夹（如"工作"、"个人"）
2. 将邮件拖拽到对应文件夹
3. 系统自动同步到服务器

### 技巧 4：定期清理存储空间

1. 定期清空回收站
2. 删除不需要的账户
3. 删除不需要的自定义文件夹

---

## 📞 获取帮助

如果遇到问题，可以：

1. 查看完整文档：`docs/功能实现-邮件拉取和账户管理优化.md`
2. 查看开发文档：`docs/二次开发说明.md`
3. 查看产品需求：`docs/PRD-产品需求文档.md`
4. 提交 Issue（如果是开源项目）

---

**祝您使用愉快！📧**
