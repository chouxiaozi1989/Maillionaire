# 版本号管理指南

> 完成日期：2025-10-19  
> 当前版本：**v1.1.0**  
> 维护人：Maillionaire Team

---

## 📋 目录

- [概述](#概述)
- [版本配置系统](#版本配置系统)
- [界面显示](#界面显示)
- [文档更新](#文档更新)
- [使用指南](#使用指南)
- [更新流程](#更新流程)
- [版本规范](#版本规范)
- [自动化工具](#自动化工具)
- [技术实现](#技术实现)

---

## 📝 概述

本文档介绍 Maillionaire 项目的版本号管理系统，包括配置文件、更新流程、显示位置以及自动化工具的使用说明。

### 实施目标

✅ **统一管理** - 创建中心化的版本配置文件  
✅ **全局显示** - 在所有界面和文档中显示版本号  
✅ **自动化** - 提供版本更新脚本工具  
✅ **规范化** - 遵循语义化版本规范  

---

## 🔧 版本配置系统

### 核心配置文件

**文件位置：`src/config/version.js`**

```javascript
export const APP_VERSION = {
  version: '1.1.0',
  buildDate: '2025-10-19',
  name: 'Maillionaire',
  description: '专业的跨平台邮件收发客户端',
  copyright: '© 2025 Maillionaire Team',
  license: 'MIT',
  
  // 完整版本字符串（动态生成）
  get fullVersion() {
    return `v${this.version}`
  },
  
  get versionString() {
    return `Version ${this.version}`
  },
  
  get fullVersionString() {
    return `Version ${this.version} (${this.buildDate})`
  },
  
  get aboutInfo() {
    return `${this.name} ${this.fullVersion} - ${this.description}`
  }
}

// 导出常用字段
export const VERSION = APP_VERSION.version
export const VERSION_FULL = APP_VERSION.fullVersion
export const BUILD_DATE = APP_VERSION.buildDate

export default APP_VERSION
```

### 配置说明

| 字段 | 类型 | 说明 |
|------|------|------|
| `version` | String | 版本号（如 `'1.1.0'`） |
| `buildDate` | String | 构建日期（如 `'2025-10-19'`） |
| `name` | String | 应用名称 |
| `description` | String | 应用描述 |
| `copyright` | String | 版权信息 |
| `license` | String | 许可证类型 |
| `fullVersion` | Getter | 完整版本（如 `'v1.1.0'`） |
| `versionString` | Getter | 版本字符串（如 `'Version 1.1.0'`） |
| `fullVersionString` | Getter | 完整版本字符串（含日期） |
| `aboutInfo` | Getter | 关于信息 |

### 配置优势

```
✅ 单一数据源 - 只需修改一处
✅ 类型安全 - 避免字符串拼接错误
✅ 格式统一 - 多种预定义格式
✅ 易于维护 - 结构清晰明了
```

---

## 🖥️ 界面显示

### 1. 登录页面

**文件：`src/views/Login.vue`**

**显示位置：** 页面底部

**显示内容：** `Version 1.1.0 | © 2025 Maillionaire Team`

**实现代码：**
```vue
<script setup>
import APP_VERSION from '@/config/version'
</script>

<template>
  <div class="login-footer">
    <div class="footer-text">
      {{ APP_VERSION.versionString }} | {{ APP_VERSION.copyright }}
    </div>
  </div>
</template>
```

### 2. 设置页面 - 关于

**文件：`src/views/Settings.vue`**

**显示位置：** 关于标签页

**显示内容：** 
- 应用名称：`Maillionaire`
- 应用描述：`专业的跨平台邮件收发客户端`
- 版本信息：`Version 1.1.0 (2025-10-19)`

**实现代码：**
```vue
<script setup>
import APP_VERSION from '@/config/version'
</script>

<template>
  <div class="about-content">
    <h1 class="about-title">{{ APP_VERSION.name }}</h1>
    <p class="about-subtitle">{{ APP_VERSION.description }}</p>
    <p class="about-version">{{ APP_VERSION.fullVersionString }}</p>
    <p class="about-copyright">{{ APP_VERSION.copyright }}</p>
  </div>
</template>
```

### 版本号显示位置总览

```
┌─────────────────────────────────────────────┐
│               程序界面显示                    │
├─────────────────────────────────────────────┤
│ 1. 登录页面底部                               │
│    "Version 1.1.0 | © 2025 Maillionaire"    │
│                                             │
│ 2. 设置 > 关于                               │
│    "Maillionaire"                           │
│    "专业的跨平台邮件收发客户端"                │
│    "Version 1.1.0 (2025-10-19)"            │
│    "© 2025 Maillionaire Team"              │
└─────────────────────────────────────────────┘
```

---

## 📄 文档更新

### 已更新的文档

| 文档 | 版本标识 | 位置 |
|------|---------|------|
| **README.md** | `版本：v1.1.0` + Badge | 顶部元数据 |
| **package.json** | `"version": "1.1.0"` | version 字段 |
| **CHANGELOG.md** | `[1.1.0] - 2025-10-19` | 版本记录 |
| **docs/README.md** | `版本：v1.1.0` | 文档头部 |
| **docs/文档目录结构说明.md** | `版本：v1.1.0` | 文档头部 |
| **所有分类文档** | `版本：v1.x.x` | 文档头部 |

### 文档版本号格式

**主 README.md：**
```markdown
<p align="center">
  <strong>版本：v1.1.0</strong> | 更新日期：2025-10-19
</p>

[![Version](https://img.shields.io/badge/version-1.1.0-blue.svg)]
```

**docs/ 文档：**
```markdown
# 文档标题

> 版本：v1.1.0  
> 更新日期：2025-10-19  
> 作者：Maillionaire Team

## 内容...
```

---

## 🚀 使用指南

### 在代码中使用版本信息

**方法1：完整导入**
```javascript
import APP_VERSION from '@/config/version'

console.log(APP_VERSION.version)          // '1.1.0'
console.log(APP_VERSION.fullVersion)      // 'v1.1.0'
console.log(APP_VERSION.versionString)    // 'Version 1.1.0'
console.log(APP_VERSION.fullVersionString)// 'Version 1.1.0 (2025-10-19)'
console.log(APP_VERSION.buildDate)        // '2025-10-19'
console.log(APP_VERSION.name)             // 'Maillionaire'
console.log(APP_VERSION.aboutInfo)        // 'Maillionaire v1.1.0 - 专业的跨平台邮件收发客户端'
```

**方法2：按需导入**
```javascript
import { VERSION, VERSION_FULL, BUILD_DATE } from '@/config/version'

console.log(VERSION)       // '1.1.0'
console.log(VERSION_FULL)  // 'v1.1.0'
console.log(BUILD_DATE)    // '2025-10-19'
```

**方法3：在 Vue 组件中使用**
```vue
<script setup>
import APP_VERSION from '@/config/version'
</script>

<template>
  <div>当前版本：{{ APP_VERSION.fullVersion }}</div>
</template>
```

### 查看当前版本

**命令行方式：**
```bash
# 查看 package.json
cat package.json | grep version

# 查看版本配置文件
cat src/config/version.js

# 使用 Node.js 读取
node -p "require('./package.json').version"
```

**程序界面：**
- 打开应用 → 登录页面底部
- 打开应用 → 设置 → 关于标签页

---

## 🔄 更新流程

### 使用自动化脚本（推荐）

**文件：`scripts/update-version.js`**

**使用方法：**
```bash
# 更新到指定版本
node scripts/update-version.js 1.2.0

# 输出示例：
# ✅ 已更新 package.json 版本号: 1.2.0
# ✅ 已更新 src/config/version.js
#    - 版本号: 1.2.0
#    - 构建日期: 2025-10-20
# 
# 📝 请手动更新以下文件：
#    1. docs/07-版本记录/CHANGELOG.md - 添加版本记录
#    2. README.md - 更新版本号和日期
#    3. Git 标签 - 运行: git tag v1.2.0 && git push origin v1.2.0
```

**脚本功能：**
- ✅ 自动更新 `package.json`
- ✅ 自动更新 `src/config/version.js`
- ✅ 自动更新构建日期
- ✅ 版本号格式验证
- ✅ 友好的命令行提示

### 手动更新流程

**步骤1：更新版本配置文件**
```javascript
// src/config/version.js
export const APP_VERSION = {
  version: '1.2.0',        // 修改这里
  buildDate: '2025-10-20', // 修改这里
  // ... 其他保持不变
}
```

**步骤2：更新 package.json**
```json
{
  "name": "maillionaire",
  "version": "1.2.0",  // 修改这里
  // ...
}
```

**步骤3：更新 CHANGELOG.md**
```markdown
## [1.2.0] - 2025-10-20

### Added
- 新增功能描述

### Changed
- 改进内容描述

### Fixed
- 修复的问题描述
```

**步骤4：更新 README.md**
```markdown
<p align="center">
  <strong>版本：v1.2.0</strong> | 更新日期：2025-10-20
</p>

[![Version](https://img.shields.io/badge/version-1.2.0-blue.svg)]
```

**步骤5：提交代码并打标签**
```bash
git add .
git commit -m "chore: bump version to 1.2.0"
git tag v1.2.0
git push origin main --tags
```

---

## 📊 版本规范

### 语义化版本（SemVer）

**格式：`MAJOR.MINOR.PATCH`**

```
MAJOR（主版本号）：不兼容的 API 修改
  - 重大架构变更
  - 不向下兼容的功能修改
  - 删除已废弃的功能
  示例：1.5.3 → 2.0.0

MINOR（次版本号）：向下兼容的功能性新增
  - 新增功能
  - 功能改进
  - 标记功能为废弃（但不删除）
  示例：1.5.3 → 1.6.0

PATCH（修订号）：向下兼容的问题修正
  - Bug 修复
  - 性能优化
  - 文档更新
  示例：1.5.3 → 1.5.4
```

### 版本示例

| 版本变更 | 类型 | 说明 |
|---------|------|------|
| `1.0.0` → `2.0.0` | MAJOR | API 重大变更，需要用户修改代码 |
| `1.0.0` → `1.1.0` | MINOR | 添加新功能（如邮件拉取、账户管理） |
| `1.1.0` → `1.1.1` | PATCH | 修复 Bug，无新功能 |
| `1.1.1` → `1.1.2` | PATCH | 性能优化、文档更新 |

### 版本历史

| 版本 | 日期 | 类型 | 主要更新 |
|------|------|------|---------|
| v1.1.0 | 2025-10-19 | MINOR | 邮件拉取优化、账户管理增强、文档整理、版本管理系统 |
| v1.0.0 | 2025-10-01 | MAJOR | 首次正式发布 |

---

## 🛠️ 自动化工具

### 版本更新脚本

**文件：`scripts/update-version.js`**

**完整代码：**
```javascript
const fs = require('fs');
const path = require('path');

// 获取新版本号参数
const newVersion = process.argv[2];

if (!newVersion) {
  console.error('❌ 错误：请提供版本号');
  console.log('📖 使用方法: node scripts/update-version.js <版本号>');
  console.log('📖 示例: node scripts/update-version.js 1.2.0');
  process.exit(1);
}

// 验证版本号格式（语义化版本）
const versionRegex = /^\d+\.\d+\.\d+$/;
if (!versionRegex.test(newVersion)) {
  console.error('❌ 错误：版本号格式不正确');
  console.log('📖 版本号必须符合语义化版本格式：MAJOR.MINOR.PATCH');
  console.log('📖 示例：1.0.0, 1.2.3, 2.0.0');
  process.exit(1);
}

// 获取当前日期
const buildDate = new Date().toISOString().split('T')[0];

console.log(`\n🚀 开始更新版本号到 ${newVersion}...\n`);

// 1. 更新 package.json
try {
  const pkgPath = path.join(__dirname, '../package.json');
  const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'));
  pkg.version = newVersion;
  fs.writeFileSync(pkgPath, JSON.stringify(pkg, null, 2) + '\n');
  console.log(`✅ 已更新 package.json 版本号: ${newVersion}`);
} catch (error) {
  console.error('❌ 更新 package.json 失败:', error.message);
  process.exit(1);
}

// 2. 更新 src/config/version.js
try {
  const versionPath = path.join(__dirname, '../src/config/version.js');
  let content = fs.readFileSync(versionPath, 'utf-8');
  
  content = content.replace(
    /version: '[^']+'/,
    `version: '${newVersion}'`
  );
  
  content = content.replace(
    /buildDate: '[^']+'/,
    `buildDate: '${buildDate}'`
  );
  
  fs.writeFileSync(versionPath, content);
  console.log(`✅ 已更新 src/config/version.js`);
  console.log(`   - 版本号: ${newVersion}`);
  console.log(`   - 构建日期: ${buildDate}`);
} catch (error) {
  console.error('❌ 更新 version.js 失败:', error.message);
  process.exit(1);
}

// 3. 提示手动更新项
console.log(`\n📝 请手动更新以下文件：`);
console.log(`   1. docs/07-版本记录/CHANGELOG.md - 添加版本记录`);
console.log(`   2. README.md - 更新版本号和日期`);
console.log(`   3. Git 标签 - 运行: git tag v${newVersion} && git push origin v${newVersion}`);

console.log(`\n✨ 版本号更新完成！\n`);
```

### 使用 npm scripts

**在 package.json 中添加：**
```json
{
  "scripts": {
    "version:update": "node scripts/update-version.js"
  }
}
```

**使用方法：**
```bash
npm run version:update 1.2.0
```

---

## 💡 技术实现

### 1. 中心化配置

**优势：**
- 单一数据源，避免不一致
- 修改一处，全局生效
- 易于维护和测试

**实现：**
```javascript
// 所有版本信息集中在一个对象中
export const APP_VERSION = {
  version: '1.1.0',
  buildDate: '2025-10-19',
  // ...
}
```

### 2. 动态字符串生成

**优势：**
- 避免手动拼接错误
- 格式统一规范
- 支持多种显示需求

**实现：**
```javascript
// 使用 ES6 Getter 动态生成
get fullVersion() {
  return `v${this.version}`
}

get fullVersionString() {
  return `Version ${this.version} (${this.buildDate})`
}
```

### 3. 响应式集成

**优势：**
- Vue 组件自动更新
- 无需手动刷新
- 类型安全

**实现：**
```vue
<script setup>
import APP_VERSION from '@/config/version'
// APP_VERSION 自动具有响应性
</script>

<template>
  <div>{{ APP_VERSION.versionString }}</div>
</template>
```

### 4. 脚本自动化

**优势：**
- 减少人工错误
- 提高更新效率
- 标准化流程

**实现：**
```javascript
// 使用 Node.js 读写文件
fs.writeFileSync(pkgPath, JSON.stringify(pkg, null, 2))
```

---

## 📋 待完善项

### 短期（1周内）

- [ ] 在主界面标题栏显示版本号
- [ ] 在应用打包时验证版本号
- [ ] 测试自动更新脚本的各种场景

### 中期（1个月内）

- [ ] 添加版本检查功能（检测新版本）
- [ ] 实现版本数据迁移机制
- [ ] CI/CD 集成版本管理
- [ ] 自动生成 Release Notes

### 长期（3个月内）

- [ ] 自动化 CHANGELOG 生成
- [ ] 版本回滚机制
- [ ] 多环境版本管理（dev/staging/prod）
- [ ] 版本对比工具

---

## 📞 问题反馈

如有版本管理相关问题：

1. **查看文档**：`docs/07-版本记录/CHANGELOG.md`
2. **提交 Issue**：描述遇到的问题
3. **联系维护者**：Maillionaire Team

---

## ✅ 总结

通过本版本号管理系统，我们实现了：

✅ **统一管理** - 单一配置源 `src/config/version.js`，全局引用  
✅ **自动化** - 提供脚本工具 `scripts/update-version.js`，提高效率  
✅ **规范化** - 遵循语义化版本规范，版本含义清晰  
✅ **可追溯** - 完整的 CHANGELOG 记录，便于版本回溯  
✅ **易维护** - 文档完善，流程标准，降低维护成本  

所有界面和文档现在都显示统一的版本号，修改版本配置文件即可全局更新！

---

**版本号管理系统实施完成！🎉**
